<include file="Public:header"/>
<script type="text/javascript" src="__WEBPUBLIC__/Admin/js/ajax-operate.js"></script>
<!--主页面-->
<div id="main-content" class="content">
    <ul class="breadcrumb">
        <li><a href="/">首页</a></li>
        <li><a href="#">脑洞管理</a></li>
        <li class="active">脑洞列表</li>
    </ul>
    <include file="Public:notification"/>
    <div class="search-content">
        <form action="{:U('Idea/ideaList')}" method="post" class="search-form form-inline" role="form" style="display: inline-block">
            <div class="form-group">
                <label class="sr-only" for="con_idea_id">请输入Idea编号</label>
                <input class="earch-input form-control" id="con_idea_id" type="text" name="con_idea_id" placeholder="请输入Idea编号"/>　
            </div>
            <button type="submit" class="btn derive">查询</button>　
        </form>
        <form action="{:U('Idea/ideaList')}" method="post" class="search-form form-inline" role="form" style="display: inline-block">
            <div class="form-group">
                <label class="sr-only" for="con_idea_content">请输入Idea内容</label>
                <input class="earch-input form-control" id="con_idea_content" type="text" name="con_idea_content" placeholder="请输入Idea内容"/>　
            </div>
            <button type="submit" class="btn derive">查询</button>　
        </form>
    </div>
    <div class="page-header clearfix">
        <h3>脑洞管理</h3>
        <ul id="tabs" class="nav nav-tabs">
            <li class="active">
                <a href="javascript:;">脑洞列表</a>
            </li>
            <li>
                <a href="{:U('Report/reportList')}">举报列表</a>
            </li>
        </ul>
    </div>
    <div class="content-box-content">
        <table class="table table-striped table-framed table-hover">
            <thead>
            <tr>
                <th width="4%">Idea编号</th>
                <th width="5%">发布时间</th>
                <th width="3%">发布人ID</th>
                <th width="4%">所属脑暴ID</th>
                <th width="10%">Idea内容</th>
                <th width="6%">Idea图片</th>
                <th width="6%" >&nbsp;&nbsp;操作</th>
            </tr>
            </thead>
            <!--标题 end-->

            <!--内容 start-->
            <tbody class="tbody">
            <if condition="empty($ideaList)">
                <tr><td colspan="10"><span style="font-size:14px;">暂无数据</span></td></tr>
            </if>
            <volist name="ideaList" id="ideaList">
                <tr>
                    <td><input type="checkbox" class="delCheck" value="{$ideaList['idea_id']}"/>&nbsp;&nbsp;{$ideaList['idea_id']}</td>
                    <td>{$ideaList['ctime']|date='Y-m-d H:i:s',###}</td>
                    <td>{$ideaList['m_id']}</td>
                    <td>{$ideaList['task_id']}</td>
                    <td>{$ideaList['content']}</td>
                    <td>
                        <empty name="ideaList.image">
                            无
                            <else />
                            <foreach name="ideaList.image" item="vo" >
                                <a target="_blank" href="__WEBROOT__/Uploads{$vo}">点击查看</a><br>
                            </foreach>
                        </empty>
                    </td>
                    <td>
                        <a href="{:U('Idea/deleteIdea',array('idea_id'=>$ideaList['idea_id']))}">删除</a>
                    </td>
                </tr>
            </volist>
            </tbody>

            <tfoot>
            <tr>
                <td colspan="20">
                    <div class="bulk-actions fl">
                        <input type="button" class="btn delete-batch" value="批量删除">
                    </div>
                    <div class="fr">
                        {$page}
                    </div>
                </td>
            </tr>
            </tfoot>
        </table>
    </div>
</div>
<script type="text/javascript">
    $(document).ready(function(){
        //批量删除
        $('.delete-batch').click(function(){
            if(confirm('确定要执行批量删除操作吗？')){
                var ids = [];
                //获取选中的信息
                $(".delCheck").each(function(){
                    if($(this).is(":checked")){
                        ids.push($(this).val());
                    }
                })
                id = ids.join(',');
                if(id != ''){
                    $.ajax(
                            {
                                'url':'{:U("Idea/deleteIdeaAll")}',
                                'type':'post',
                                'data':{
                                    id:id,
                                },
                                success: function(data){
                                    data = JSON.parse(data);
                                    if(data.success){
                                        alert(data.success);
                                        $(".delCheck").each(function(){
                                            $(this).attr("checked",false);
                                        })
                                        location.reload();
                                    }else{
                                        alert(data.error);
                                    }
                                }
                            }
                    )
                }
            }
        });
    });
</script>
<include file="Public:footer"/>
