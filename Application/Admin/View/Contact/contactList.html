<include file="Public:header"/>
<script type="text/javascript" src="__WEBPUBLIC__/Admin/js/ajax-operate.js"></script>
<!--主页面-->
<div id="main-content" class="content">

    <ul class="breadcrumb">
        <li><a href="/">首页</a></li>
    </ul>

    <include file="Public:notification"/>
       
    <div class="content-box-content">

        <form action="{:U('Contact/deleteContact')}" method="post" class="batch-form">
            <table class="table table-striped table-framed table-hover">
                <!--标题 start-->
                <thead>
                <tr>
                    <th width="4%">编号</th>
                    <th width="4%">姓名</th>
                    <th width="6%">电话</th>
                    <th width="7%">邮箱</th>
                    <th width="25%">详细信息</th>
                    <th width="8%">发送时间</th>
                    <th width="5%">操作</th>
                </tr>
                </thead>
                <!--标题 end-->

                <!--内容 start-->
                <tbody class="tbody">
                <if condition="empty($contactList)">
                    <tr><td colspan="10"><span style="font-size:14px;">暂无数据</span></td></tr>
                </if>
                <volist name="contactList" id="contact">
                    <tr>
                        <td>
                            <input type="checkbox" class="delCheck" value="{$contact['contact_id']}"/>&nbsp;&nbsp;{$contact['contact_id']}
                        </td>
                        <td>{$contact['username']}</td>
                        <td>{$contact['userphone']}</td>
                        <td>{$contact['useremail']}</td>
                        <td>{$contact['userinfo']}</td>
                        <td>{$contact['ctime']|date='Y-m-d H:i:s',###}</td>
                        <td>
                            <a href="{:U('Contact/deleteContact',array('contact_id'=>$contact['contact_id']))}" title="删除">删除</a>
                        </td>
                    </tr>
                </volist>
                </tbody>
                <!--内容 end-->
                <!--表尾 start-->
                <tfoot>
                <tr>
                    <td colspan="20">
                        <div class="bulk-actions fl">
                            <input type="button" class="btn delete-batch" value="批量删除">
                        </div>
                        <div class="fr">
                            {$page}
                        </div>
                    </td>
                </tr>
                </tfoot>
                <!--表尾 end-->
            </table>
        </form>
    </div>
</div>
<include file="Public:footer"/>
<script type="text/javascript">
    $(document).ready(function(){
        //批量删除
        $('.delete-batch').click(function(){
            if(confirm('确定要执行批量删除操作吗？')){
                var ids = [];
                //获取选中的信息
                $(".delCheck").each(function(){
                    if($(this).is(":checked")){
                        ids.push($(this).val());
                    }
                })
                id = ids.join(',');
                if(id != ''){
                    $.ajax(
                            {
                                'url':'{:U("Contact/deleteContactAll")}',
                                'type':'post',
                                'data':{
                                    id:id,
                                },
                                success: function(data){
                                    data = JSON.parse(data);
                                    if(data.success){
                                        alert(data.success);
                                        $(".delCheck").each(function(){
                                            $(this).attr("checked",false);
                                        })
                                        location.reload();
                                    }else{
                                        alert(data.error);
                                    }
                                }
                            }
                    )
                }
            }
        });
    });
</script>
